# تصميم بنية روبوت تداول العملات المشفرة

## 1. نظرة عامة

يهدف هذا المستند إلى تحديد البنية المقترحة لروبوت تداول العملات المشفرة بناءً على المتطلبات المقدمة. سيشمل الروبوت واجهة أمامية (Frontend) لإدارة الروبوت ومراقبة الأداء، وخدمة خلفية (Backend) لتنفيذ منطق التداول والتفاعل مع منصات التداول.

## 2. التقنيات المقترحة

*   **الواجهة الأمامية (Frontend):** Next.js (إطار عمل React) - يوفر تجربة تطوير حديثة، وتوجيه الصفحات، وإمكانية العرض من جانب الخادم (SSR) أو إنشاء مواقع ثابتة (SSG)، بالإضافة إلى سهولة النشر على Vercel.
*   **الخدمة الخلفية (Backend):** Node.js مع Express.js - بيئة تشغيل JavaScript شائعة وفعالة لبناء واجهات برمجة التطبيقات (APIs)، مع إطار عمل Express.js لتسهيل عملية التطوير.
*   **مكتبة التداول:** CCXT - مكتبة موحدة للتفاعل مع العديد من منصات تداول العملات المشفرة، بما في ذلك Binance و MEXC.
*   **مؤشرات التحليل الفني:** `technicalindicators` أو مكتبة مشابهة لحساب RSI و MACD و EMA.
*   **قاعدة البيانات / التسجيل:** ملفات CSV مبدئيًا لتسجيل الصفقات والنشاط لسهولة الإعداد، مع إمكانية الترقية إلى قاعدة بيانات (مثل SQLite أو PostgreSQL) لاحقًا إذا لزم الأمر.
*   **الإشعارات:** `node-telegram-bot-api` لإرسال إشعارات Telegram.
*   **إدارة الحالة (Frontend):** React Context API أو Zustand لإدارة الحالة العامة للتطبيق (مثل حالة الروبوت، الإعدادات، بيانات المستخدم).
*   **التصميم (Frontend):** Tailwind CSS مع مكتبة مكونات مثل shadcn/ui لتصميم واجهة مستخدم حديثة ومتجاوبة بسرعة.

## 3. بنية التطبيق

سيتم تقسيم المشروع إلى جزأين رئيسيين:

1.  **تطبيق الواجهة الأمامية (Next.js):**
    *   **المسؤوليات:** عرض البيانات للمستخدم، السماح للمستخدم بتكوين الإعدادات، التحكم في حالة الروبوت (تشغيل/إيقاف)، عرض الأرصدة والصفقات والتاريخ والأرباح/الخسائر.
    *   **الهيكل:**
        *   `pages/`: صفحات التطبيق (لوحة التحكم، الإعدادات، التاريخ).
        *   `components/`: مكونات واجهة المستخدم القابلة لإعادة الاستخدام (عرض الرصيد، جداول الطلبات، نماذج الإعدادات، إلخ).
        *   `lib/` أو `utils/`: وظائف مساعدة وأدوات.
        *   `hooks/`: خطافات React مخصصة.
        *   `context/` أو `store/`: لإدارة الحالة.
        *   `styles/`: ملفات التنسيق (CSS).
    *   **التفاعل مع الخلفية:** ستتواصل الواجهة الأمامية مع الخدمة الخلفية عبر طلبات HTTP API (RESTful) لجلب البيانات وإرسال الأوامر.

2.  **تطبيق الخدمة الخلفية (Node.js/Express):**
    *   **المسؤوليات:** التفاعل الآمن مع واجهات برمجة تطبيقات Binance و MEXC باستخدام مفاتيح المستخدم، جلب بيانات السوق، حساب المؤشرات، تطبيق منطق التداول، تنفيذ الأوامر، إدارة المخاطر، إرسال الإشعارات، تسجيل النشاط.
    *   **الهيكل:**
        *   `src/`: الكود المصدري الرئيسي.
            *   `controllers/`: معالجة طلبات API الواردة.
            *   `routes/`: تعريف نقاط نهاية API.
            *   `services/`: منطق الأعمال الأساسي (التداول، الاتصال بالمنصات، الإشعارات، التسجيل).
            *   `utils/`: وظائف مساعدة.
            *   `config/`: إعدادات التطبيق (تحميل متغيرات البيئة).
            *   `models/` (اختياري): تعريف هياكل البيانات إذا تم استخدام قاعدة بيانات.
        *   `app.js` أو `server.js`: نقطة الدخول الرئيسية للتطبيق.
    *   **منطق التداول:** سيتم تشغيله كعملية دورية (باستخدام `setInterval` أو `node-cron`) لجلب البيانات وتحليلها واتخاذ قرارات التداول بناءً على الاستراتيجية المحددة (RSI, MACD, EMA, Volume).
    *   **الأمان:** سيتم تخزين مفاتيح API الخاصة بالمستخدم بشكل آمن باستخدام متغيرات البيئة (`.env` محليًا ومتغيرات البيئة في منصة النشر).

## 4. تدفق البيانات والعمليات الرئيسية

1.  **الإعداد الأولي:** المستخدم يدخل مفاتيح API الخاصة به عبر الواجهة الأمامية، والتي ترسلها بشكل آمن إلى الخلفية لتخزينها كمتغيرات بيئة (أو طريقة آمنة أخرى).
2.  **تشغيل الروبوت:** المستخدم يبدأ تشغيل الروبوت من الواجهة الأمامية.
3.  **دورة التداول (الخلفية):**
    *   الخدمة الخلفية تجلب بيانات السوق (الشموع، الحجم) للمنصات والعملات المحددة.
    *   تحسب المؤشرات الفنية (RSI, MACD, EMA).
    *   تتحقق من شروط الدخول (شراء/بيع) بناءً على المؤشرات والحجم.
    *   تتحقق من قواعد إدارة المخاطر (الحد الأقصى للصفقات المفتوحة، حجم المركز، السيولة، السبريد).
    *   إذا تحققت الشروط، تنفذ أمر التداول (مع وقف الخسارة وهدف الربح).
    *   تسجل الصفقة في ملف السجل (CSV).
    *   ترسل إشعارًا (Telegram).
    *   تكرر العملية بعد فترة زمنية محددة (مثل دقيقة واحدة أو 5 دقائق).
4.  **عرض البيانات (الواجهة الأمامية):**
    *   الواجهة الأمامية تطلب بشكل دوري بيانات محدثة من الخلفية (الأرصدة، الصفقات المفتوحة، التاريخ، حالة الروبوت).
    *   تعرض البيانات للمستخدم في لوحة التحكم.

## 5. النشر (Deployment)

*   **الواجهة الأمامية (Next.js):** سيتم نشرها على Vercel، مع ربطها بمستودع GitHub للنشر التلقائي عند التحديث.
*   **الخدمة الخلفية (Node.js):** سيتم نشرها بشكل منفصل على منصة تدعم تطبيقات Node.js طويلة الأمد (مثل Render, Heroku, أو خادم VPS). يجب تكوين متغيرات البيئة (مفاتيح API، توكن Telegram، إلخ) على منصة النشر.
*   **مستودع GitHub:** سيحتوي على مجلدين رئيسيين (`frontend` و `backend`) أو مستودعين منفصلين، مع ملف `README.md` واضح يشرح كيفية إعداد وتشغيل كل جزء.

## 6. اعتبارات إضافية

*   **معالجة الأخطاء:** يجب تنفيذ معالجة قوية للأخطاء في كل من الواجهة الأمامية والخلفية (مثل فشل طلبات API، أخطاء الاتصال بالمنصة، أخطاء تنفيذ الأوامر).
*   **الاختبار:** يجب إضافة اختبارات (وحدات، تكامل) خاصة للخلفية ومنطق التداول لضمان الموثوقية. يمكن إضافة وحدة اختبار خلفي (Backtesting) كما هو مطلوب.
*   **قابلية التوسع:** تصميم الكود بشكل نمطي (Modular) لتسهيل إضافة ميزات أو منصات تداول جديدة في المستقبل.
